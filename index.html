<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Turnos 6x2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        /* Aseguramos que el contenedor de la app tome la altura m√≠nima de la pantalla */
        #root { min-height: 100vh; }
        /* Animaci√≥n del spinner */
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen flex items-center justify-center p-4">
        </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin defer></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin defer></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js" defer></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js" defer></script>
    <script type="text/babel" defer>
        // Acceso a las librer√≠as cargadas por CDN
        const { useState, useEffect, useCallback } = React;
        const { jsPDF } = window.jspdf;

        // --- CONFIGURACI√ìN DE FIREBASE (¬°AJUSTAR!) ---
        // IMPORTANTE: REEMPLAZA ESTA API KEY POR LA NUEVA QUE CREASTE EN FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC_gewonkD_XnzQmwmUnQuhfzOf5zdm9lw",
            authDomain: "calculadora-6x2.firebaseapp.com",
            projectId: "calculadora-6x2",
            storageBucket: "calculadora-6x2.firebasestorage.app",
            messagingSenderId: "238926197886",
            appId: "1:238926197886:web:d05857b007dcb305e9d42f"
        };
        const appId = 'calculadora-6x2'; // Usamos el ID de tu proyecto como app ID
        
        // Inicializaci√≥n y servicios
        let app, db, auth;

        // --- UTILITIES Y L√ìGICA DE NEGOCIO ---

        const getYesterdayDate = () => {
            const date = new Date();
            date.setDate(date.getDate() - 1);
            return date.toISOString().split('T')[0];
        };

        const getTurnEquivalencies = (dayOfWeek, turnType) => {
            let realHours = 8;
            let equivalentHours = 8;
            let turnBaseName = turnType;

            if (dayOfWeek >= 1 && dayOfWeek <= 5) { // Lunes a Viernes
                switch (turnType) {
                    case 'Ma√±ana':
                    case 'Tarde':
                        equivalentHours = 8;
                        break;
                    case 'Noche':
                        equivalentHours = 12; // Noche de lunes a viernes es 12
                        break;
                }
            } else if (dayOfWeek === 6) { // S√°bado
                switch (turnType) {
                    case 'Ma√±ana':
                        realHours = 8;
                        equivalentHours = 9; // S√°b Ma√±ana
                        break;
                    case 'Tarde':
                        realHours = 9;
                        equivalentHours = 12; // S√°b Tarde
                        break;
                    case 'Noche':
                        realHours = 8;
                        equivalentHours = 16; // S√°b Noche
                        break;
                }
            } else if (dayOfWeek === 0) { // Domingo
                turnBaseName = 'Domingo ' + turnType;
                switch (turnType) {
                    case 'Ma√±ana':
                    case 'Tarde':
                        realHours = 8;
                        equivalentHours = 24; // Dom Ma√±ana/Tarde
                        break;
                    case 'Noche':
                    case 'Noche':
                        realHours = 8;
                        equivalentHours = 28; // Dom Noche
                        break;
                }
            }

            return { realHours, equivalentHours, turnBaseName };
        };

        // --- COMPONENTES PRINCIPALES ---

        const LoadingSpinner = () => (
            <div className="flex flex-col items-center justify-center h-full">
                <svg className="animate-spin h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p className="mt-3 text-sm text-gray-600">Conectando con la base de datos...</p>
            </div>
        );

        const AuthScreen = ({ signInWithGoogle }) => (
            <div className="p-8 max-w-sm w-full bg-white shadow-xl rounded-xl text-center">
                <h1 className="text-3xl font-bold text-indigo-700 mb-4">Bienvenido</h1>
                <p className="text-gray-600 mb-8">Inicia sesi√≥n para guardar tu configuraci√≥n y historial.</p>
                <button
                    onClick={signInWithGoogle}
                    className="w-full py-3 px-4 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold transition duration-150 flex items-center justify-center"
                >
                    <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M22.54 12.06c0-.82-.07-1.62-.2-2.4h-1.32v2.4h-1.32v2.4h1.32v2.4c0 .82.07 1.62.2 2.4h1.32v-2.4h1.32v-2.4h-1.32v-2.4zm-2.4-5.32c.13.82.2 1.62.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32V4.34h-1.32v2.4zm-3.26 12.7c-.13-.82-.2-1.62-.2-2.4h-1.32v2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4zm-1.84 0c-.13.82-.2 1.62-.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4zm-1.84 0c-.13.82-.2 1.62-.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4zm-1.84 0c-.13.82-.2 1.62-.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4zm-1.84 0c-.13.82-.2 1.62-.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4zm-1.84 0c-.13.82-.2 1.62-.2 2.4h-1.32v-2.4h1.32v2.4h1.32v-2.4h-1.32v-2.4z"/></svg>
                    Continuar con Google
                </button>
            </div>
        );


        const App = () => {
            const [user, setUser] = useState(null); // Contiene el objeto User de Firebase (si est√° logueado)
            const [userId, setUserId] = useState(null); // Contiene el UID para Firestore
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [config, setConfig] = useState({
                month: new Date().getMonth() + 1,
                year: new Date().getFullYear(),
                valorHora: 3758,
                lastFrancoDate: getYesterdayDate(), // YYYY-MM-DD
                initialTurn: 'Ma√±ana',
                discountRate: 0.18,
            });
            const [calculationResult, setCalculationResult] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [status, setStatus] = useState(null);
            
            // 1. Inicializaci√≥n y Autenticaci√≥n de Firebase
            useEffect(() => {
                // Verificamos si la variable global 'firebase' existe antes de usarla
                if (typeof firebase === 'undefined' || typeof firebase.initializeApp !== 'function') {
                    console.error("Firebase library failed to load.");
                    setStatus({ type: 'error', message: "Error cr√≠tico: La librer√≠a de Firebase no se carg√≥. Revisa las URLs CDN." });
                    setIsAuthReady(true);
                    return;
                }

                try {
                    if (!app) {
                        app = firebase.initializeApp(firebaseConfig);
                        // *** SINTAXIS V8 CL√ÅSICA (CORRECCI√ìN) ***
                        db = firebase.firestore();
                        auth = firebase.auth();
                        // ****************************************
                    }
                } catch (e) {
                    console.error("Firebase Initialization Error:", e);
                    setStatus({ type: 'error', message: "Error al inicializar Firebase. Revisa la configuraci√≥n (mock)." });
                    setIsAuthReady(true);
                    return;
                }

                // onAuthStateChanged se dispara cuando Firebase est√° listo
                const unsubscribe = auth.onAuthStateChanged((user) => { 
                    if (user) {
                        setUser(user);
                        setUserId(user.uid);
                    } else {
                        // Si no hay usuario logueado, mantenemos el estado nulo para mostrar AuthScreen
                        setUser(null);
                        setUserId(null);
                    }
                    setIsAuthReady(true);
                });

                return () => unsubscribe();
            }, []);
            
            // Funci√≥n para iniciar sesi√≥n con Google
            const signInWithGoogle = useCallback(async () => {
                if (!auth) return;
                setIsLoading(true);
                setStatus({ type: 'info', message: "Iniciando sesi√≥n con Google..." });

                try {
                    const provider = new firebase.auth.GoogleAuthProvider();
                    // Esto redirige la p√°gina para autenticarse.
                    await auth.signInWithRedirect(provider); 

                } catch (error) {
                    console.error("Google Sign-In Error:", error);
                    setStatus({ type: 'error', message: `Fallo en el inicio de sesi√≥n: ${error.code}` });
                    setIsLoading(false);
                }
            }, []);

            // 2. Carga de Configuraci√≥n del Usuario (Listener Firestore)
            useEffect(() => {
                // Solo procedemos si la autenticaci√≥n est√° lista Y tenemos un ID de usuario v√°lido
                if (!isAuthReady || !userId || !db) return;

                setStatus({ type: 'info', message: "Sincronizando configuraci√≥n personal..." });
                
                // *** SINTAXIS V8 DE REFERENCIA A DOCUMENTO (CORRECCI√ìN) ***
                // Path: /artifacts/{appId}/users/{userId}/config/salary
                const userDocRef = db.collection('artifacts').doc(appId)
                    .collection('users').doc(userId)
                    .collection('config').doc('salary');
                // ********************************************************
                
                // Escuchamos los cambios en el documento (onSnapshot = Listener)
                const unsubscribe = userDocRef.onSnapshot((docSnap) => {
                    if (docSnap.exists) {
                        const data = docSnap.data();
                        setConfig(prev => ({
                            ...prev,
                            ...data,
                            // Convertimos a n√∫mero porque Firestore a veces almacena como strings
                            valorHora: Number(data.valorHora) || prev.valorHora,
                            discountRate: Number(data.discountRate) || prev.discountRate,
                        }));
                        setStatus({ type: 'success', message: "Configuraci√≥n personal cargada y sincronizada." });
                    } else {
                        // Si el documento no existe, lo creamos con la configuraci√≥n por defecto (para el primer uso)
                        setStatus({ type: 'info', message: "Documento de configuraci√≥n no encontrado. Creando uno por defecto." });
                        saveConfig(config);
                    }
                }, (error) => {
                    console.error("Error fetching config:", error);
                    setStatus({ type: 'error', message: "Error al cargar la configuraci√≥n. Revisa tus Reglas de Seguridad de Firestore." });
                });

                return () => unsubscribe();
            }, [isAuthReady, userId]);

            // 3. Guardar Configuraci√≥n
            const saveConfig = useCallback((newConfig) => {
                if (!isAuthReady || !userId || !db) return;
                
                // *** SINTAXIS V8 DE REFERENCIA A DOCUMENTO (CORRECCI√ìN) ***
                const userDocRef = db.collection('artifacts').doc(appId)
                    .collection('users').doc(userId)
                    .collection('config').doc('salary');
                // ********************************************************

                userDocRef.set({ // El m√©todo 'set' sobre la referencia (V8)
                    ...newConfig, 
                    valorHora: Number(newConfig.valorHora), 
                    discountRate: Number(newConfig.discountRate) 
                }, { merge: true }) // merge: true asegura que no borra otros campos
                    .catch(error => {
                        console.error("Error saving config:", error);
                        setStatus({ type: 'error', message: "Error al guardar la configuraci√≥n. Revisa tus credenciales o reglas de Firebase." });
                    });
            }, [isAuthReady, userId]);

            // 4. Manejador de Cambios de Formulario
            const handleChange = (e) => {
                const { name, value, type } = e.target;
                // Convertimos el valor inmediatamente si es num√©rico
                const newValue = (type === 'number' || name === 'valorHora' || name === 'discountRate') ? parseFloat(value) : value;

                setConfig(prev => {
                    const updatedConfig = { ...prev, [name]: newValue };
                    // Guardamos autom√°ticamente al cambiar un campo
                    saveConfig(updatedConfig); 
                    return updatedConfig;
                });
            };

            // --- L√ìGICA CENTRAL DE C√ÅLCULO (NO MODIFICADA) ---
            
            const calculateSchedule = useCallback(() => {
                // ... (Cuerpo de la funci√≥n calculateSchedule, la dej√© como estaba ya que la l√≥gica del c√°lculo es correcta)
                if (!isAuthReady) {
                    setStatus({ type: 'error', message: "Autenticaci√≥n no lista. Intente de nuevo." });
                    return;
                }

                const { month, year, valorHora, lastFrancoDate, initialTurn, discountRate } = config;
                
                if (!month || !year || !valorHora || !lastFrancoDate || !initialTurn || !discountRate) {
                    setStatus({ type: 'error', message: "Faltan campos obligatorios para calcular." });
                    return;
                }

                setIsLoading(true);
                setStatus({ type: 'info', message: "Calculando horario y salario..." });

                const hourlyRate = parseFloat(valorHora) || 0;
                
                const lastFrancoDay2 = new Date(lastFrancoDate + 'T00:00:00');
                const dayAfterFranco = new Date(lastFrancoDay2.getTime());
                dayAfterFranco.setDate(dayAfterFranco.getDate() + 1); 
                
                const dayNames = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
                let currentDate = new Date(year, month - 1, 1, 0, 0, 0); 
                
                let dailyResults = [];
                let francosDates = [];
                let totalEquivalentHours = 0;
                
                const masterCycle = [
                    'Ma√±ana', 'Ma√±ana', 'Ma√±ana', 'Ma√±ana', 'Ma√±ana', 'Ma√±ana', 'Franco', 'Franco', 
                    'Noche', 'Noche', 'Noche', 'Noche', 'Noche', 'Noche', 'Franco', 'Franco', 
                    'Tarde', 'Tarde', 'Tarde', 'Tarde', 'Tarde', 'Tarde', 'Franco', 'Franco'
                ];
                
                let baseOffset = 0;
                if (initialTurn === 'Noche') {
                    baseOffset = 8;
                } else if (initialTurn === 'Tarde') {
                    baseOffset = 16;
                }
                
                // C√°lculo de diferencia de d√≠as para encontrar el punto de partida en el ciclo de 24 d√≠as
                const diffTime = currentDate.getTime() - dayAfterFranco.getTime();
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                let startOffset = (baseOffset + diffDays) % 24; 
                if (startOffset < 0) startOffset += 24; 

                let dayCounter = 0;
                while (currentDate.getMonth() === month - 1 && dayCounter < 31) {
                    const dayOfWeek = currentDate.getDay(); 
                    const dateString = currentDate.toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    
                    const cycleStatus = masterCycle[startOffset]; 
                    
                    let turnBaseName = cycleStatus;
                    let realHours = 0;
                    let equivalentHours = 0;
                    
                    if (cycleStatus === 'Franco') {
                        realHours = 0;
                        equivalentHours = 0;
                        francosDates.push(dateString);
                    } else {
                        const equivalences = getTurnEquivalencies(dayOfWeek, cycleStatus);
                        realHours = equivalences.realHours;
                        equivalentHours = equivalences.equivalentHours;
                        turnBaseName = equivalences.turnBaseName;
                    }
                    
                    const dailyBruto = equivalentHours * hourlyRate;
                    totalEquivalentHours += equivalentHours;
                    
                    dailyResults.push({
                        date: dateString,
                        day: dayNames[dayOfWeek],
                        turn: turnBaseName,
                        realHours: realHours,
                        equivHours: equivalentHours,
                        dailyBruto: dailyBruto,
                    });
                    
                    startOffset = (startOffset + 1) % 24;
                    currentDate.setDate(currentDate.getDate() + 1);
                    dayCounter++;
                }

                const totalBruto = totalEquivalentHours * hourlyRate;
                const totalDescuento = totalBruto * discountRate;
                const totalNeto = totalBruto - totalDescuento;

                setCalculationResult({
                    dailyResults,
                    francosDates,
                    totalEquivalentHours,
                    totalBruto,
                    totalDescuento,
                    totalNeto,
                    discountRate: discountRate * 100,
                });

                setIsLoading(false);
                setStatus({ type: 'success', message: `C√°lculo de ${dailyResults.length} d√≠as completado. Neto estimado: ${formatCurrency(totalNeto)}` });
                
            }, [config, isAuthReady]);
            
            const formatCurrency = (amount) => {
                return amount.toLocaleString('es-AR', { style: 'currency', currency: 'ARS' });
            };

            // --- GENERACI√ìN DE PDF PROFESIONAL (NO MODIFICADA) ---
            const generatePdf = () => {
                if (!calculationResult) {
                    setStatus({ type: 'error', message: "Primero debes generar el c√°lculo." });
                    return;
                }

                const doc = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4',
                });
                
                const { totalBruto, totalDescuento, totalNeto, discountRate, dailyResults } = calculationResult;
                
                const monthName = new Date(config.year, config.month - 1).toLocaleDateString('es-AR', { month: 'long', year: 'numeric' });

                // T√≠tulo
                doc.setFontSize(18);
                doc.text(`REPORTE SALARIAL MENSUAL`, 105, 15, null, null, 'center');
                doc.setFontSize(12);
                doc.text(`C√°lculo para ${monthName}`, 105, 22, null, null, 'center');

                // Resumen Financiero
                doc.setFillColor(240, 240, 240);
                doc.rect(15, 30, 180, 40, 'F'); 

                doc.setFontSize(10);
                doc.text('RESUMEN', 17, 35);
                
                doc.setFontSize(12);
                doc.text('BRUTO TOTAL:', 20, 42);
                doc.text(formatCurrency(totalBruto), 190, 42, null, null, 'right');
                
                doc.text(`DESCUENTO (${discountRate.toFixed(0)}%):`, 20, 50);
                doc.setTextColor(217, 48, 37); 
                doc.text(`- ${formatCurrency(totalDescuento)}`, 190, 50, null, null, 'right');
                
                doc.setTextColor(0, 0, 0); 
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.setFillColor(217, 234, 211); 
                doc.rect(15, 58, 180, 10, 'F');
                doc.text('NETO (EN MANO):', 20, 65);
                doc.text(formatCurrency(totalNeto), 190, 65, null, null, 'right');

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text(`ID de Usuario: ${userId}`, 15, 75);

                // Detalle Diario (Tabla)
                doc.setFontSize(12);
                doc.text('Detalle de Turnos y Horas Equivalentes', 15, 85);
                
                const tableColumns = ["Fecha", "D√≠a", "Turno Base", "H. Reales", "H. Eq.", "Monto Bruto"];
                const tableRows = dailyResults.map(r => [
                    r.date,
                    r.day,
                    r.turn,
                    r.realHours || '-',
                    r.equivHours || '-',
                    r.dailyBruto ? formatCurrency(r.dailyBruto) : '-',
                ]);

                doc.autoTable({
                    startY: 90,
                    head: [tableColumns],
                    body: tableRows,
                    theme: 'grid',
                    styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak' },
                    headStyles: { fillColor: [207, 226, 243] }, 
                    columnStyles: {
                        0: { cellWidth: 20 }, 
                        3: { cellWidth: 15, halign: 'center' }, 
                        4: { cellWidth: 15, halign: 'center' }, 
                        5: { halign: 'right' }, 
                    },
                    bodyStyles: (data) => {
                        if (data.row.raw[2].includes('Franco')) {
                            return { fillColor: [255, 242, 204] }; 
                        }
                        return {};
                    }
                });

                // Footer
                doc.setFontSize(8);
                doc.text("Generado por la Calculadora de Rotaci√≥n 6x2. Este es un estimado.", 105, doc.internal.pageSize.height - 10, null, null, 'center');

                doc.save(`Reporte_Salarial_${monthName}.pdf`);
                setStatus({ type: 'success', message: "PDF generado con √©xito y descargado." });
            };

            const StatusMessage = ({ type, message }) => {
                if (!message) return null;
                const baseClass = "p-3 rounded-lg mt-4 font-semibold";
                let colorClass = "";
                switch (type) {
                    case 'success': colorClass = "bg-green-100 text-green-700"; break;
                    case 'error': colorClass = "bg-red-100 text-red-700"; break;
                    case 'info': colorClass = "bg-blue-100 text-blue-700"; break;
                    default: colorClass = "bg-gray-100 text-gray-700"; break;
                }
                return <div className={`${baseClass} ${colorClass}`}>{message}</div>;
            };

            // 5. Renderizado Principal (Si no est√° autenticado, muestra la pantalla de inicio)
            if (!isAuthReady) {
                return <div className="p-4 w-full h-full"><LoadingSpinner /></div>;
            }
            
            if (!user) {
                 return <AuthScreen signInWithGoogle={signInWithGoogle} />;
            }

            return (
                <div className="p-4 max-w-lg w-full bg-white shadow-xl rounded-xl">
                    <h1 className="text-2xl font-bold text-indigo-700 border-b pb-2 mb-4">
                        Calculadora de Rotaci√≥n 6x2
                    </h1>
                    <div className="text-sm mb-4 p-2 bg-indigo-50 rounded-lg">
                        <p className="font-medium text-indigo-600">ID de Usuario (Privado): {userId}</p>
                        <p className="text-xs text-indigo-500">Tu configuraci√≥n se guarda autom√°ticamente en Firebase.</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div className="col-span-1">
                            <label className="block text-sm font-medium text-gray-700">Mes a Calcular</label>
                            <select name="month" value={config.month} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                {Array.from({ length: 12 }, (_, i) => i + 1).map(m => (
                                    <option key={m} value={m}>{new Date(config.year, m - 1).toLocaleDateString('es-AR', { month: 'long' })}</option>
                                ))}
                            </select>
                        </div>
                        <div className="col-span-1">
                            <label className="block text-sm font-medium text-gray-700">A√±o</label>
                            <input type="number" name="year" value={config.year} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" />
                        </div>
                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-gray-700">Valor de la Hora Bruta ($)</label>
                            <input type="number" name="valorHora" value={config.valorHora} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" />
                        </div>
                        
                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-gray-700">Fecha del √öltimo Franco (D√≠a 2)</label>
                            <input type="date" name="lastFrancoDate" value={config.lastFrancoDate} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" />
                            <p className="text-xs text-gray-500 mt-1">D√≠a de finalizaci√≥n de tus √∫ltimos dos francos.</p>
                        </div>
                        
                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-gray-700">Turno que comenz√≥ el d√≠a despu√©s del Franco</label>
                            <select name="initialTurn" value={config.initialTurn} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Ma√±ana">Ma√±ana</option>
                                <option value="Noche">Noche</option>
                                <option value="Tarde">Tarde</option>
                            </select>
                        </div>

                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-gray-700">Afiliaci√≥n (Descuento)</label>
                            <select name="discountRate" value={config.discountRate} onChange={handleChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value={0.18}>No Afiliado (18%)</option>
                                <option value={0.21}>Afiliado (21%)</option>
                            </select>
                        </div>
                    </div>

                    <button 
                        onClick={calculateSchedule} 
                        disabled={isLoading}
                        className={`w-full py-2 mt-6 rounded-lg text-white font-bold transition duration-150 ${isLoading ? 'bg-indigo-400' : 'bg-indigo-600 hover:bg-indigo-700'}`}
                    >
                        {isLoading ? 'Calculando...' : 'Generar C√°lculo y Horario'}
                    </button>
                    
                    <StatusMessage type={status?.type} message={status?.message} />

                    {calculationResult && (
                        <div className="mt-6 border-t pt-4">
                            <h2 className="text-xl font-bold text-indigo-700 mb-4">Resumen de Ganancias</h2>
                            <div className="grid grid-cols-2 gap-4 text-sm font-medium">
                                <div className="p-3 bg-gray-50 rounded-lg">
                                    <p className="text-gray-500">Horas Equivalentes Totales:</p>
                                    <p className="text-lg text-gray-900 font-extrabold">{calculationResult.totalEquivalentHours}</p>
                                </div>
                                <div className="p-3 bg-red-50 rounded-lg">
                                    <p className="text-gray-500">Descuento ({calculationResult.discountRate.toFixed(0)}%):</p>
                                    <p className="text-lg text-red-600 font-extrabold">{formatCurrency(calculationResult.totalDescuento)}</p>
                                </div>
                                <div className="col-span-1 p-3 bg-indigo-50 rounded-lg">
                                    <p className="text-gray-500">Bruto Total:</p>
                                    <p className="text-xl text-indigo-600 font-extrabold">{formatCurrency(calculationResult.totalBruto)}</p>
                                </div>
                                <div className="col-span-1 p-3 bg-green-100 rounded-lg shadow-md">
                                    <p className="text-green-700 font-semibold">NETO (EN MANO) ESTIMADO:</p>
                                    <p className="text-2xl text-green-800 font-extrabold">{formatCurrency(calculationResult.totalNeto)}</p>
                                </div>
                            </div>

                            <div className="mt-4 p-3 bg-yellow-50 rounded-lg text-sm">
                                <strong className="text-yellow-800">üóìÔ∏è Francos del Mes:</strong>
                                <p className="mt-1 text-yellow-700">{calculationResult.francosDates.join(', ') || 'No hay francos en el mes seleccionado.'}</p>
                            </div>

                            <button 
                                onClick={generatePdf}
                                className="w-full py-2 mt-4 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold transition duration-150 flex items-center justify-center"
                            >
                                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                Descargar Reporte PDF Profesional
                            </button>
                            
                            <details className="mt-4 p-3 border rounded-lg">
                                <summary className="font-semibold cursor-pointer">Ver Detalle Diario</summary>
                                <div className="overflow-x-auto mt-2">
                                    <table className="min-w-full divide-y divide-gray-200 text-xs">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-3 py-2 text-left text-gray-500">Fecha</th>
                                                <th className="px-3 py-2 text-left text-gray-500">D√≠a</th>
                                                <th className="px-3 py-2 text-left text-gray-500">Turno</th>
                                                <th className="px-3 py-2 text-right text-gray-500">H. Eq.</th>
                                                <th className="px-3 py-2 text-right text-gray-500">Monto Bruto</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {calculationResult.dailyResults.map((day, index) => (
                                                <tr key={index} className={day.turn.includes('Franco') ? 'bg-yellow-50' : ''}>
                                                    <td className="px-3 py-2 whitespace-nowrap">{day.date}</td>
                                                    <td className="px-3 py-2 whitespace-nowrap">{day.day.substring(0, 3)}</td>
                                                    <td className="px-3 py-2 whitespace-nowrap font-medium text-indigo-600">{day.turn}</td>
                                                    <td className="px-3 py-2 whitespace-nowrap text-right">{day.equivHours || '-'}</td>
                                                    <td className="px-3 py-2 whitespace-nowrap text-right">{formatCurrency(day.dailyBruto)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </details>

                        </div>
                    )}
                </div>
            );
        };

        // Renderizar la aplicaci√≥n usando el m√©todo moderno de React 18
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
